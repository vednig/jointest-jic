<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Test</title></head>
<script>
function hidem() {
  document.getElementById("minfo").hidden="true";
  document.getElementById("expand").removeAttribute("hidden")
}
function expandem() {
  document.getElementById("minfo").removeAttribute("hidden");
  document.getElementById("expand").hidden="true"
}
</script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<style>
    .form-control:focus {
  border-color: #FF0000;
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(255, 0, 0, 0.6);
}
    input.form-control {
    width: auto;
}
#BarLine{
    position:relative;
    bottom: 0;
    width: 100%;
    text-align: center;
    background-color:teal;
  }
.Endpage{
    position:relative;
    bottom: 0;
    width: 100%;
    text-align: center;
    background-color: rgb(25, 133, 133);
    color:rgb(208, 255, 0);
  }
lasttime{
  input[type="datet"]::before{
   color: #ffffff;
   content: attr(placeholder) ": ";
}
input[type="date"]:focus::before {
   content: "" !important;
}
}
</style>
<body style="background-color: black;color:white">
<h1 class="text-success">JoIn Test<span class="badge badge-secondary">BETA</span></h1>

<hr color="red" style="color: brown;background-color: brown;background-image: none;background-attachment:fixed;">
<div id="expand" style="align-items:center;align-self:center;align-content: center;min-width:100%;margin-left: 48%;"  hidden>
  <button class="btn btn-outline-success" onclick="expandem()">
    <img><svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-archive-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" d="M12.643 15C13.979 15 15 13.845 15 12.5V5H1v7.5C1 13.845 2.021 15 3.357 15h9.286zM5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM.8 1a.8.8 0 0 0-.8.8V3a.8.8 0 0 0 .8.8h14.4A.8.8 0 0 0 16 3V1.8a.8.8 0 0 0-.8-.8H.8z"/>
        </svg>
    </img>
  </button>
  Enter Last Acceptable Date:
  <input type="datetime-local" id="lasttime">
</div>
<div id="game" class="container">
  <div class="row" id="minfo">
<input type="number" name="Marks" id="" placeholder="Total Marks" class="form-control form-control">
&nbsp;
  &nbsp;<input type="text" name="School" id="1n" placeholder="Topic" class="form-control form-control">
  
  &nbsp;<input type="text" name="Class" id="1a" placeholder="Class" class="form-control form-control">
  &nbsp;<input type="number" name="Time Limit" id="1b" placeholder="Time Limit(in minutes)" class="form-control form-control">
  &nbsp;<input type="num" name="No. of Questions" id="1c" placeholder="No. of Questions" class="form-control form-control">
<button onclick="add1('multi')" id="yo" class="btn btn-outline-warning" style="min-width: 50%;">Add Question</button>
<button type="submit" style="color: blanchedalmond;float:left; min-width:50%;" onclick="dummy()"class="btn btn-outline-info">Done</button>
<button type="menu" style="min-width: 100%;" class="btn btn-outline-dark" onclick="hidem()" id="menuinfo"><img><svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-box-arrow-in-up" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" fill="grey" d="M3.5 10a.5.5 0 0 1-.5-.5v-8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 0 0 1h2A1.5 1.5 0 0 0 14 9.5v-8A1.5 1.5 0 0 0 12.5 0h-9A1.5 1.5 0 0 0 2 1.5v8A1.5 1.5 0 0 0 3.5 11h2a.5.5 0 0 0 0-1h-2z"/>
  <path fill-rule="evenodd" fill="grey" d="M7.646 4.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V14.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3z"/>
</svg></img></button>
</div>
<textarea id="instructions" placeholder="Type your test Instructions Here." class="form-control form-control"></textarea>
  &nbsp;
<div class="row" id="fooBar"></div>
<div class="Endpage" id="Barline" style="min-height: 2cm;"><div id="AccountDetails" style="color:whitesmoke;"></div>End of Test Page </div>
</div>

<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.23.0/firebase-app.js"></script>
<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/7.23.0/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.23.0/firebase-database.js"></script>
  <!-- Add Firebase products that you want to use -->
  <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-auth.js"></script>

<script>
  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  var firebaseConfig = {
    apiKey: "AIzaSyByQu3_pmxkcGhd6Ynq-TcrF0LcCnkHIw8",
    authDomain: "jointest-jic.firebaseapp.com",
    databaseURL: "https://jointest-jic.firebaseio.com",
    projectId: "jointest-jic",
    storageBucket: "jointest-jic.appspot.com",
    messagingSenderId: "142037296584",
    appId: "1:142037296584:web:f26548aaeb20b8a763ccfd",
    measurementId: "G-QP01TYN2JC"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
  firebase.auth().signInAnonymously().catch(function(error) {
  // Handle Errors here.
  var errorCode = error.code;
  var errorMessage = error.message;
  console.log(errorCode,errorMessage)
  // ...
});
var authid;
firebase.auth().onAuthStateChanged(function(user) {
  if (user) {
    // User is signed in.
    var isAnonymous = user.isAnonymous;
    authid = user.uid;
    document.getElementById("AccountDetails").innerHTML="You're assigned uid : "+authid+"which is Anonmously "+ isAnonymous
    // ...
  } else {
    // User is signed out.
    // ...
    document.getElementById("AccountDetails").st.color="black"
    document.getElementById("AccountDetails").innerHTML="Please Refresh page! or Try again later"
  }
  // ...
});
  var database = firebase.database();
  tcode=0
  function writeUserData(uid,index,question,option1,option2,option3,option4,addon,tcode) {
  firebase.database().ref('beta/' + 'uid/'+ uid+"/"+"simplesheet/"+tcode+"/"+"paper/"+index).set({
    question:question,
    option1:option1,
    option2:option2,
    option3:option3,
    option4:option4,
    addon:addon
  });
  firebase.database().ref('beta/'+'uid/'+uid+'/'+'simplesheet/'+tcode+"/"+"num").set({
    count:num,
    info:document.getElementById("1n").value,
    time:document.getElementById("1b").value,
    lastdate:document.getElementById("lasttime").value,
    instructions: document.getElementById("instructions").value,
    aclass: document.getElementsByName("Class")[0].value,
    admin:authid
  });
}
num = 0
ind=0
dope=0
//Variables and All
divn=1

function dummy() {
  for (let letter = 1; letter < divn; letter++) {
    qname="Question"+letter;
    oname1=letter+"."+"Option1";
    oname2=letter+"."+"Option2";
    oname3=letter+"."+"Option3";
    oname4=letter+"."+"Option4";
    aoname=letter+"."+"addon";
    index=letter;
    question=document.getElementById(qname).value;
    option1=document.getElementById(oname1).value;
    option2=document.getElementById(oname2).value;
    option3=document.getElementById(oname3).value;
    option4=document.getElementById(oname4).value;
    addon=document.getElementById(aoname).value;
  writeUserData(uid,index,question,option1,option2,option3,option4,addon,tcode)
  };
}
//Work done


    function add1(x){
  dope=parseInt(dope)+parseInt(1);
  divn=parseInt(divn)+parseInt(1);
	var column=document.createElement("div");
	column.setAttribute("id", dope);
	column.setAttribute("class","col-sm");	
	var col = document.getElementById("fooBar");
	col.appendChild(column);
  add(x);
  startref();
}
function startref(){
  dummy();
}
    function add(x){
        num=parseInt(num)+parseInt(1);
        //Create an input type dynamically.
        var element = document.createElement("input");
        var labelname = "Question"+ num +"."
        var addon = document.createElement("textarea");
        var addonlname = "Addon"+" "+ "Description" +"."
        var addonid=num+"."+ "addon"
            //Create Labels
        var label = document.createElement("label");
        label.innerHTML = labelname;     
        idname =  "Question"+ num
	var divname = "Question "+ num
        //Assign different attributes to the element.
        element.setAttribute("type", "text");
        element.setAttribute("placeholder", "Your Question Here");
        element.setAttribute("name", "Question"+num);
        element.setAttribute("style", "width:200px");
        element.setAttribute("id", idname);
	element.setAttribute("class", "input-group-text");
	element.setAttribute("aria-describedby", "basic-addon1");
	element.setAttribute("style","background-color:black;color:white");
        label.setAttribute("style", "font-weight:normal;color:red");
        addon.setAttribute("id",addonid)
        addon.setAttribute("placeholder",addonlname)
        addon.setAttribute("class","input-group-text")
        addon.setAttribute("hidden","true")
    // 'foobar' is the div id, where new fields are to be added
    var foo = document.getElementById(dope);
    //Append the element in page (in span).
    foo.appendChild(label);
    foo.appendChild(element);
    foo.appendChild(addon);
    if (x=="multi") {
            for (let index = 1; index < 5; index++) {
                var element = document.createElement("input");
                var labelname = "Option"+ index +"."
                //Create Labels
                var label = document.createElement("Label");
                label.innerHTML = labelname;     
                idname =  num+"."+"Option"+ index
                //Assign different attributes to the element.
                element.setAttribute("type", "text");
                element.setAttribute("placeholder", "Option here.");
                element.setAttribute("name", divname);
                element.setAttribute("style", "width:200px;");
                element.setAttribute("id", idname);
                label.setAttribute("style", "font-weight:normal;color:#149fc9;");
		element.setAttribute("class","form-control form-control");

                // 'foobar' is the div id, where new fields are to be added
                var foo = document.getElementById(dope);
                foo.appendChild(label);
                foo.appendChild(element);
            }
        }
    }
    var jdata;
         jdata={
    "jsonrpc": "2.0",
    "method": "generateStrings",
    "params": {
        "apiKey": "e8013a6b-9485-47a6-98c9-eb663bdaeff3",
        "n": 1,
        "length": 6,
        "characters": "abcdefghijklmnopqrstuvwxyz",
        "replacement": true
    },
    "id": 42
};
 // level is key and levelVal is value
var xhttp = new XMLHttpRequest();
xhttp.open("POST", "https://api.random.org/json-rpc/2/invoke", true);
xhttp.setRequestHeader('Content-Type', 'application/json');
xhttp.send(JSON.stringify(jdata));

xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        var obj=JSON.parse(this.responseText);
      console.log("uid","is",obj['result']['random']['data'][0]);
      uid=obj['result']['random']['data'][0];
      ref=firebase.database().ref('beta/' + 'uid/'+ uid)
      ref.once("value", function(snapshot) {
        if (snapshot.exists()) {
          console.log("exists!");
          resend()

          
        } else{
          return uid=obj['result']['random']['data'][0];
         };
      });
      
    }
    
}
function resend() {
  var xhttp = new XMLHttpRequest();
xhttp.open("POST", "https://api.random.org/json-rpc/2/invoke", true);
xhttp.setRequestHeader('Content-Type', 'application/json');
xhttp.send(JSON.stringify(jdata));
xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        var obj=JSON.parse(this.responseText);
      console.log("uid","is",obj['result']['random']['data'][0]);
      uid=obj['result']['random']['data'][0];
      ref=firebase.database().ref('beta/' + 'uid/'+ uid)
      ref.once("value", function(snapshot) {
        if (snapshot.exists()) {
          console.log("exists!");
          resend()          
        } else{
          return uid=obj['result']['random']['data'][0];
         };
      });
      
    }}
}   

</script>
<body>

</body>
</body>
</html>